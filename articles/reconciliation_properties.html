<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Properties of the reconciled distribution via conditioning • bayesRecon</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Properties of the reconciled distribution via conditioning">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bayesRecon</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/bayesRecon.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/mixed_reconciliation.html">Reconciliation of M5 hierarchy with mixed-type forecasts</a></li>
    <li><a class="dropdown-item" href="../articles/reconciliation_properties.html">Properties of the reconciled distribution via conditioning</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/IDSIA/bayesRecon/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Properties of the reconciled distribution via conditioning</h1>
                        <h4 data-toc-skip class="author">Lorenzo Zambon,
Giorgio Corani</h4>
            
            <h4 data-toc-skip class="date">2023-12-19</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/IDSIA/bayesRecon/blob/main/vignettes/reconciliation_properties.Rmd" class="external-link"><code>vignettes/reconciliation_properties.Rmd</code></a></small>
      <div class="d-none name"><code>reconciliation_properties.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette reproduces the results of the paper <em>Properties of
the reconciled distributions for Gaussian and count forecasts</em> <span class="citation">(Zambon et al. 2024)</span>, accepted for publication
in the International Journal of Forecasting. We replicate here the main
experiment of the paper (see sec. 3, <span class="citation">Zambon et
al. (2024)</span>) where we reconcile base forecasts constituted by
negative binomial distributions.</p>
<p>We use the R package <code>BayesRecon</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/IDSIA/bayesRecon" class="external-link">bayesRecon</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-and-base-forecasts">Data and base forecasts<a class="anchor" aria-label="anchor" href="#data-and-base-forecasts"></a>
</h2>
<p>We release a new data set, containing time series of counts of
extreme market events in five economic sectors in the period 2005-2018
(3508 trading days). The counts are computed by considering 29 companies
included in the Euro Stoxx 50 index and observing if the value of the
CDS spread on a given day exceeds the 90-th percentile of its
distribution in the last trading year. The companies are divided into
the following sectors: Financial (FIN), Information and Communication
Technology (ICT), Manufacturing (MFG), Energy (ENG), and Trade
(TRD).</p>
<p>The hierarchy is composed of 5 bottom time series, the daily number
of extreme market<br>
events in each sector, and 1 upper time series (the sum of the different
sectors). Data are stored in <code>extr_mkt_events</code>.</p>
<div class="figure">
<img src="img%2FfinTS_hier.jpg" alt="**Figure 1**: financial time series hierarchy." width="80%"><p class="caption">
<strong>Figure 1</strong>: financial time series hierarchy.
</p>
</div>
<p>We also make available as <code>extr_mkt_events_basefc</code> the
base forecasts to be reconciled. As discussed in the paper, they are
produced using the model by <span class="citation">(Agosto 2022)</span>;
the predictive distributions are negative binomial.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Hierarchy composed by 6 time series: 5 bottom and 1 upper</span></span>
<span><span class="va">n_b</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">n_u</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="va">n_b</span> <span class="op">+</span> <span class="va">n_u</span>   </span>
<span></span>
<span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, ncol <span class="op">=</span> <span class="va">n_b</span>, nrow <span class="op">=</span> <span class="va">n_u</span><span class="op">)</span>  <span class="co"># aggregation matrix</span></span>
<span></span>
<span><span class="co"># Actual values:</span></span>
<span><span class="va">actuals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">extr_mkt_events</span><span class="op">)</span>  <span class="co"># convert to data frame</span></span>
<span><span class="co"># Base forecasts:</span></span>
<span><span class="va">base_fc</span> <span class="op">&lt;-</span> <span class="va">extr_mkt_events_basefc</span></span>
<span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">actuals</span><span class="op">)</span>  <span class="co"># number of days (3508)</span></span>
<span></span>
<span><span class="co"># # If you want to run only N reconciliations (instead of 3508):</span></span>
<span><span class="co"># N &lt;- 200</span></span>
<span><span class="co"># actuals &lt;- actuals[1:N,]</span></span>
<span><span class="co"># base_fc$mu &lt;- base_fc$mu[1:N,]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="reconciliation-via-conditioning">Reconciliation via conditioning<a class="anchor" aria-label="anchor" href="#reconciliation-via-conditioning"></a>
</h2>
<p>We reconcile the base forecasts via conditioning, using importance
sampling. We use the <code>reconc_BUIS</code> function, which implements
the BUIS algorithm <span class="citation">(Zambon, Azzimonti, and Corani
2024)</span>; since there is only one upper time series in the
hierarchy, the BUIS algorithm is equivalent to importance sampling. We
perform 3508 reconciliations, one for each day, drawing each time 10,000
samples from the reconciled distribution. We use 10,000 samples instead
of 100,000 (as in the paper) to speed up the computation.</p>
<p>For each day, we save the empirical mean, median, and quantiles of
the reconciled distribution.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We need to save the mean and median of the reconciled distribution</span></span>
<span><span class="co"># in order to compute the squared error and the absolute error:</span></span>
<span><span class="va">rec_means</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, ncol <span class="op">=</span> <span class="va">n</span>, nrow <span class="op">=</span> <span class="va">N</span><span class="op">)</span></span>
<span><span class="va">rec_medians</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, ncol <span class="op">=</span> <span class="va">n</span>, nrow <span class="op">=</span> <span class="va">N</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We need to save the lower and upper quantiles of the reconciled distribution</span></span>
<span><span class="co"># in order to compute the interval score:</span></span>
<span><span class="va">rec_L</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, ncol <span class="op">=</span> <span class="va">n</span>, nrow <span class="op">=</span> <span class="va">N</span><span class="op">)</span></span>
<span><span class="va">rec_U</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, ncol <span class="op">=</span> <span class="va">n</span>, nrow <span class="op">=</span> <span class="va">N</span><span class="op">)</span></span>
<span><span class="va">int_cov</span> <span class="op">=</span> <span class="fl">0.9</span>   <span class="co"># use 90% interval         </span></span>
<span><span class="va">q1</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">int_cov</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span><span class="va">q2</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">int_cov</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span></span>
<span><span class="co"># Set the number of samples to draw from the reconciled distribution:</span></span>
<span><span class="va">N_samples</span> <span class="op">&lt;-</span> <span class="fl">1e4</span></span>
<span></span>
<span><span class="va">start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Base forecasts:</span></span>
<span>  <span class="va">base_fc_j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>   </span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">base_fc_j</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">base_fc</span><span class="op">$</span><span class="va">size</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, mu <span class="op">=</span> <span class="va">base_fc</span><span class="op">$</span><span class="va">mu</span><span class="op">[[</span><span class="va">j</span>,<span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Reconcile via importance sampling:</span></span>
<span>  <span class="va">buis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reconc_BUIS.html">reconc_BUIS</a></span><span class="op">(</span><span class="va">A</span>, <span class="va">base_fc_j</span>, <span class="st">"params"</span>, <span class="st">"nbinom"</span>, </span>
<span>                      num_samples <span class="op">=</span> <span class="va">N_samples</span>, seed <span class="op">=</span> <span class="fl">42</span><span class="op">)</span></span>
<span>  <span class="va">samples_y</span> <span class="op">&lt;-</span> <span class="va">buis</span><span class="op">$</span><span class="va">reconciled_samples</span></span>
<span>  </span>
<span>  <span class="co"># Save mean, median, and lower and upper quantiles:</span></span>
<span>  <span class="va">rec_means</span><span class="op">[</span><span class="va">j</span>,<span class="op">]</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">samples_y</span><span class="op">)</span></span>
<span>  <span class="va">rec_medians</span><span class="op">[</span><span class="va">j</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">samples_y</span>, <span class="fl">1</span>, <span class="va">median</span><span class="op">)</span></span>
<span>  <span class="va">rec_L</span><span class="op">[</span><span class="va">j</span>,<span class="op">]</span>       <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">samples_y</span>, <span class="fl">1</span>, <span class="va">quantile</span>, <span class="va">q1</span><span class="op">)</span></span>
<span>  <span class="va">rec_U</span><span class="op">[</span><span class="va">j</span>,<span class="op">]</span>       <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">samples_y</span>, <span class="fl">1</span>, <span class="va">quantile</span>, <span class="va">q2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">stop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Computational time for "</span>, <span class="va">N</span>, <span class="st">" reconciliations: "</span>,     </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">stop</span>, <span class="va">start</span>, units <span class="op">=</span> <span class="st">"secs"</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"s"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Computational time for  3508  reconciliations:  59.88 s</span></span></code></pre></div>
<p>We compute the median and the quantiles of the negative binomial base
forecasts.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">base_means</span>   <span class="op">&lt;-</span> <span class="va">base_fc</span><span class="op">$</span><span class="va">mu</span></span>
<span><span class="va">base_medians</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, ncol <span class="op">=</span> <span class="va">n</span>, nrow <span class="op">=</span> <span class="va">N</span><span class="op">)</span></span>
<span><span class="va">base_L</span>       <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, ncol <span class="op">=</span> <span class="va">n</span>, nrow <span class="op">=</span> <span class="va">N</span><span class="op">)</span></span>
<span><span class="va">base_U</span>       <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, ncol <span class="op">=</span> <span class="va">n</span>, nrow <span class="op">=</span> <span class="va">N</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">base_medians</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">base_means</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, </span>
<span>                       <span class="kw">function</span><span class="op">(</span><span class="va">mu</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/NegBinomial.html" class="external-link">qnbinom</a></span><span class="op">(</span>p<span class="op">=</span><span class="fl">0.5</span>, size<span class="op">=</span><span class="va">base_fc</span><span class="op">$</span><span class="va">size</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, mu<span class="op">=</span><span class="va">mu</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">base_L</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>       <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">base_means</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, </span>
<span>                       <span class="kw">function</span><span class="op">(</span><span class="va">mu</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/NegBinomial.html" class="external-link">qnbinom</a></span><span class="op">(</span>p<span class="op">=</span><span class="va">q1</span>,  size<span class="op">=</span><span class="va">base_fc</span><span class="op">$</span><span class="va">size</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, mu<span class="op">=</span><span class="va">mu</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">base_U</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>       <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">base_means</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, </span>
<span>                       <span class="kw">function</span><span class="op">(</span><span class="va">mu</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/NegBinomial.html" class="external-link">qnbinom</a></span><span class="op">(</span>p<span class="op">=</span><span class="va">q2</span>,  size<span class="op">=</span><span class="va">base_fc</span><span class="op">$</span><span class="va">size</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, mu<span class="op">=</span><span class="va">mu</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>For each day and for each time series, we compute the absolute error,
the squared error, and the interval score for the base and reconciled
forecasts.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute the squared errors</span></span>
<span><span class="va">SE_base</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">base_means</span> <span class="op">-</span> <span class="va">actuals</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="va">SE_rec</span>  <span class="op">&lt;-</span> <span class="op">(</span><span class="va">rec_means</span> <span class="op">-</span> <span class="va">actuals</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span></span>
<span><span class="co"># Compute the absolute errors</span></span>
<span><span class="va">AE_base</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">base_medians</span> <span class="op">-</span> <span class="va">actuals</span><span class="op">)</span></span>
<span><span class="va">AE_rec</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">rec_medians</span> <span class="op">-</span> <span class="va">actuals</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define the function for the interval score</span></span>
<span><span class="va">int_score</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">l</span>, <span class="va">u</span>, <span class="va">actual</span>, <span class="va">int_cov</span> <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">is</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">u</span> <span class="op">-</span> <span class="va">l</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fl">2</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">int_cov</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">actual</span> <span class="op">-</span> <span class="va">u</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">actual</span><span class="op">&gt;</span><span class="va">u</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fl">2</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">int_cov</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">l</span> <span class="op">-</span> <span class="va">actual</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">l</span><span class="op">&gt;</span><span class="va">actual</span><span class="op">)</span> </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">is</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Compute the interval scores</span></span>
<span><span class="va">IS_base</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="va">int_score</span>, <span class="va">base_L</span>, <span class="va">base_U</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.matrix.html" class="external-link">data.matrix</a></span><span class="op">(</span><span class="va">actuals</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">IS_base</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">IS_base</span>, nrow <span class="op">=</span> <span class="va">N</span><span class="op">)</span></span>
<span><span class="va">IS_rec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="va">int_score</span>, <span class="va">rec_L</span>, <span class="va">rec_U</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.matrix.html" class="external-link">data.matrix</a></span><span class="op">(</span><span class="va">actuals</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">IS_rec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">IS_rec</span>, nrow <span class="op">=</span> <span class="va">N</span><span class="op">)</span></span></code></pre></div>
<p>We compute and show the skill scores, which measure the improvement
of the reconciled forecasts over the base forecasts. The skill score is
symmetric and bounded between -2 and 2.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SS_AE</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">AE_base</span> <span class="op">-</span> <span class="va">AE_rec</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">AE_base</span> <span class="op">+</span> <span class="va">AE_rec</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span></span>
<span><span class="va">SS_SE</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">SE_base</span> <span class="op">-</span> <span class="va">SE_rec</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">SE_base</span> <span class="op">+</span> <span class="va">SE_rec</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span></span>
<span><span class="va">SS_IS</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">IS_base</span> <span class="op">-</span> <span class="va">IS_rec</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">IS_base</span> <span class="op">+</span> <span class="va">IS_rec</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span></span>
<span><span class="va">SS_AE</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">SS_AE</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">SS_SE</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">SS_SE</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">SS_IS</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">SS_IS</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="va">mean_skill_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">SS_IS</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">SS_SE</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">SS_AE</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mean_skill_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">mean_skill_scores</span>, nrow <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mean_skill_scores</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">actuals</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">mean_skill_scores</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Interval score"</span>, <span class="st">"Squared error"</span>, <span class="st">"Absolute error"</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">mean_skill_scores</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">ALL</th>
<th align="right">FIN</th>
<th align="right">ICT</th>
<th align="right">MFG</th>
<th align="right">ENG</th>
<th align="right">TRD</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Interval score</td>
<td align="right">0.86</td>
<td align="right">1.13</td>
<td align="right">0.20</td>
<td align="right">1.08</td>
<td align="right">0.21</td>
<td align="right">0.20</td>
</tr>
<tr class="even">
<td align="left">Squared error</td>
<td align="right">0.82</td>
<td align="right">1.08</td>
<td align="right">1.10</td>
<td align="right">1.08</td>
<td align="right">1.05</td>
<td align="right">1.16</td>
</tr>
<tr class="odd">
<td align="left">Absolute error</td>
<td align="right">-0.02</td>
<td align="right">-0.02</td>
<td align="right">-0.01</td>
<td align="right">-0.02</td>
<td align="right">-0.03</td>
<td align="right">-0.02</td>
</tr>
</tbody>
</table>
<p>The table closely matches Table 4 of the paper. In order to exactly
reproduce the paper table, it is necessary increase the number of
samples drawn from the reconciled distribution to 100,000.</p>
</div>
<div class="section level2">
<h2 id="reconciled-mean-and-variance">Reconciled mean and variance<a class="anchor" aria-label="anchor" href="#reconciled-mean-and-variance"></a>
</h2>
<p>We now show the effects of the reconciliation on the mean and
variance of the forecast distribution. For more details, we refer to
Section 3.2 of the paper.</p>
<p>We observe two different behaviors for the reconciled upper mean: it
can be between the base and the bottom-up mean (<em>combination</em>
effect) or it can be lower than both (<em>concordant-shift</em> effect).
We show them for two different days.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Now we draw a larger number of samples:</span></span>
<span><span class="va">N_samples</span> <span class="op">&lt;-</span> <span class="fl">1e5</span></span>
<span></span>
<span><span class="co">### Example of concordant-shift effect</span></span>
<span><span class="va">j</span> <span class="op">&lt;-</span> <span class="fl">124</span></span>
<span><span class="va">base_fc_j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>   </span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="va">base_fc_j</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">extr_mkt_events_basefc</span><span class="op">$</span><span class="va">size</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                                      mu <span class="op">=</span> <span class="va">extr_mkt_events_basefc</span><span class="op">$</span><span class="va">mu</span><span class="op">[[</span><span class="va">j</span>,<span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># Reconcile</span></span>
<span><span class="va">buis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reconc_BUIS.html">reconc_BUIS</a></span><span class="op">(</span><span class="va">A</span>, <span class="va">base_fc_j</span>, <span class="st">"params"</span>, <span class="st">"nbinom"</span>, </span>
<span>                    num_samples <span class="op">=</span> <span class="va">N_samples</span>, seed <span class="op">=</span> <span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">samples_y</span> <span class="op">&lt;-</span> <span class="va">buis</span><span class="op">$</span><span class="va">reconciled_samples</span></span>
<span></span>
<span><span class="co"># The reconciled mean is lower than both the base and bottom-up means:</span></span>
<span><span class="va">means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">extr_mkt_events_basefc</span><span class="op">$</span><span class="va">mu</span><span class="op">[[</span><span class="va">j</span>,<span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">extr_mkt_events_basefc</span><span class="op">$</span><span class="va">mu</span><span class="op">[</span><span class="va">j</span>,<span class="fl">2</span><span class="op">:</span><span class="va">n</span><span class="op">]</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">samples_y</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">col_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Base upper mean"</span>, <span class="st">"Bottom-up upper mean"</span>, <span class="st">"Reconciled upper mean"</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">means</span>, nrow<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, col.names <span class="op">=</span> <span class="va">col_names</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">Base upper mean</th>
<th align="right">Bottom-up upper mean</th>
<th align="right">Reconciled upper mean</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">10.67</td>
<td align="right">9.1</td>
<td align="right">8.29</td>
</tr></tbody>
</table>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">### Example of combination effect </span></span>
<span><span class="va">j</span> <span class="op">&lt;-</span> <span class="fl">1700</span></span>
<span><span class="va">base_fc_j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>   </span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="va">base_fc_j</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">extr_mkt_events_basefc</span><span class="op">$</span><span class="va">size</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                                      mu <span class="op">=</span> <span class="va">extr_mkt_events_basefc</span><span class="op">$</span><span class="va">mu</span><span class="op">[[</span><span class="va">j</span>,<span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># Reconcile </span></span>
<span><span class="va">buis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reconc_BUIS.html">reconc_BUIS</a></span><span class="op">(</span><span class="va">A</span>, <span class="va">base_fc_j</span>, <span class="st">"params"</span>, <span class="st">"nbinom"</span>, </span>
<span>                    num_samples <span class="op">=</span> <span class="va">N_samples</span>, seed <span class="op">=</span> <span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">samples_y</span> <span class="op">&lt;-</span> <span class="va">buis</span><span class="op">$</span><span class="va">reconciled_samples</span></span>
<span></span>
<span><span class="co"># The reconciled mean is between the base and the bottom-up mean:</span></span>
<span><span class="va">means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">extr_mkt_events_basefc</span><span class="op">$</span><span class="va">mu</span><span class="op">[[</span><span class="va">j</span>,<span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">extr_mkt_events_basefc</span><span class="op">$</span><span class="va">mu</span><span class="op">[</span><span class="va">j</span>,<span class="fl">2</span><span class="op">:</span><span class="va">n</span><span class="op">]</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">samples_y</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">col_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Base upper mean"</span>, <span class="st">"Bottom-up upper mean"</span>, <span class="st">"Reconciled upper mean"</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">means</span>, nrow<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, col.names <span class="op">=</span> <span class="va">col_names</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">Base upper mean</th>
<th align="right">Bottom-up upper mean</th>
<th align="right">Reconciled upper mean</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">26.51</td>
<td align="right">43.39</td>
<td align="right">35.74</td>
</tr></tbody>
</table>
<p>Finally, we show an example in which the variance of the bottom time
series increases after reconciliation. This is a major difference with
the Gaussian reconciliation, for which the reconciled variance is always
smaller than the base variance.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">j</span> <span class="op">&lt;-</span> <span class="fl">2308</span></span>
<span><span class="va">base_fc_j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>   </span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="va">base_fc_j</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">extr_mkt_events_basefc</span><span class="op">$</span><span class="va">size</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                                      mu <span class="op">=</span> <span class="va">extr_mkt_events_basefc</span><span class="op">$</span><span class="va">mu</span><span class="op">[[</span><span class="va">j</span>,<span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># Reconcile</span></span>
<span><span class="va">buis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reconc_BUIS.html">reconc_BUIS</a></span><span class="op">(</span><span class="va">A</span>, <span class="va">base_fc_j</span>, <span class="st">"params"</span>, <span class="st">"nbinom"</span>, num_samples <span class="op">=</span> <span class="va">N_samples</span>, seed <span class="op">=</span> <span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">samples_y</span> <span class="op">&lt;-</span> <span class="va">buis</span><span class="op">$</span><span class="va">reconciled_samples</span></span>
<span></span>
<span><span class="co"># Compute the variance of the base and reconciled bottom forecasts</span></span>
<span><span class="va">base_bottom_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">mu</span>, <span class="va">size</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/NegBinomial.html" class="external-link">rnbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1e5</span>, size <span class="op">=</span> <span class="va">size</span>, mu <span class="op">=</span> <span class="va">mu</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                          <span class="va">extr_mkt_events_basefc</span><span class="op">$</span><span class="va">mu</span><span class="op">[</span><span class="va">j</span>,<span class="fl">2</span><span class="op">:</span><span class="va">n</span><span class="op">]</span>, </span>
<span>                          <span class="va">extr_mkt_events_basefc</span><span class="op">$</span><span class="va">size</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="va">n</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">rec_bottom_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">samples_y</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="va">n</span>,<span class="op">]</span>, MARGIN <span class="op">=</span> <span class="fl">1</span>, <span class="va">var</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># The reconciled variance is greater than the base variance:</span></span>
<span><span class="va">bottom_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">base_bottom_var</span>, <span class="va">rec_bottom_var</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">bottom_var</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"var base"</span>, <span class="st">"var reconc"</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">bottom_var</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">FIN</th>
<th align="right">ICT</th>
<th align="right">MFG</th>
<th align="right">ENG</th>
<th align="right">TRD</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">var base</td>
<td align="right">11.42</td>
<td align="right">2.26</td>
<td align="right">1.48</td>
<td align="right">0.34</td>
<td align="right">1.36</td>
</tr>
<tr class="even">
<td align="left">var reconc</td>
<td align="right">14.14</td>
<td align="right">2.57</td>
<td align="right">1.63</td>
<td align="right">0.39</td>
<td align="right">1.53</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-agosto2022multivariate" class="csl-entry">
Agosto, Arianna. 2022. <span>“Multivariate Score-Driven Models for Count
Time Series to Assess Financial Contagion.”</span> <a href="https://doi.org/10.2139/ssrn.4119895" class="external-link">https://doi.org/10.2139/ssrn.4119895</a>.
</div>
<div id="ref-zambon2024properties" class="csl-entry">
Zambon, Lorenzo, Arianna Agosto, Paolo Giudici, and Giorgio Corani.
2024. <span>“Properties of the Reconciled Distributions for Gaussian and
Count Forecasts.”</span> <em>International Journal of Forecasting</em>.
</div>
<div id="ref-zambon2022efficient" class="csl-entry">
Zambon, Lorenzo, Dario Azzimonti, and Giorgio Corani. 2024.
<span>“Efficient Probabilistic Reconciliation of Forecasts for
Real-Valued and Count Time Series.”</span> <em>Statistics and
Computing</em> 34 (1): 21. <a href="https://doi.org/10.1007/s11222-023-10343-y" class="external-link">https://doi.org/10.1007/s11222-023-10343-y</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dario Azzimonti, Nicolò Rubattu, Lorenzo Zambon, Giorgio Corani.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
