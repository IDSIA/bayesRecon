<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Analytical reconciliation of Gaussian base forecasts — reconc_gaussian • bayesRecon</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Analytical reconciliation of Gaussian base forecasts — reconc_gaussian"><meta name="description" content="Closed form computation of the reconciled forecasts in case of Gaussian base forecasts."><meta property="og:description" content="Closed form computation of the reconciled forecasts in case of Gaussian base forecasts."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bayesRecon</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/bayesRecon.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/mixed_reconciliation.html">Reconciliation of M5 hierarchy with mixed-type forecasts</a></li>
    <li><a class="dropdown-item" href="../articles/reconciliation_properties.html">Properties of the reconciled distribution via conditioning</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/IDSIA/bayesRecon/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Analytical reconciliation of Gaussian base forecasts</h1>
      <small class="dont-index">Source: <a href="https://github.com/IDSIA/bayesRecon/blob/main/R/reconc_gaussian.R" class="external-link"><code>R/reconc_gaussian.R</code></a></small>
      <div class="d-none name"><code>reconc_gaussian.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Closed form computation of the reconciled forecasts in case of Gaussian base forecasts.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">reconc_gaussian</span><span class="op">(</span><span class="va">A</span>, <span class="va">base_forecasts.mu</span>, <span class="va">base_forecasts.Sigma</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-a">A<a class="anchor" aria-label="anchor" href="#arg-a"></a></dt>
<dd><p>aggregation matrix (n_upper x n_bottom).</p></dd>


<dt id="arg-base-forecasts-mu">base_forecasts.mu<a class="anchor" aria-label="anchor" href="#arg-base-forecasts-mu"></a></dt>
<dd><p>a vector containing the means of the base forecasts.</p></dd>


<dt id="arg-base-forecasts-sigma">base_forecasts.Sigma<a class="anchor" aria-label="anchor" href="#arg-base-forecasts-sigma"></a></dt>
<dd><p>a matrix containing the covariance matrix of the base forecasts.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing the bottom reconciled forecasts. The list has the following named elements:</p><ul><li><p><code>bottom_reconciled_mean</code>: reconciled mean for the bottom forecasts;</p></li>
<li><p><code>bottom_reconciled_covariance</code>: reconciled covariance for the bottom forecasts.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>In the vector of the means of the base forecasts the order must be: first the upper,
then the bottom; the order within the uppers is given by the rows of A,
the order within the bottoms by the columns of A.
The order of the rows of the covariance matrix of the base forecasts is the same.</p>
<p>The function returns only the reconciled parameters of the bottom variables.
The reconciled upper parameters and the reconciled samples for the entire hierarchy
can be obtained from the reconciled bottom parameters.
See the example section.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Corani, G., Azzimonti, D., Augusto, J.P.S.C., Zaffalon, M. (2021).
<em>Probabilistic Reconciliation of Hierarchical Forecast via Bayes' Rule</em>.
ECML PKDD 2020. Lecture Notes in Computer Science, vol 12459.
<a href="https://doi.org/10.1007/978-3-030-67664-3_13" class="external-link">doi:10.1007/978-3-030-67664-3_13</a>
.</p>
<p>Zambon, L., Agosto, A., Giudici, P., Corani, G. (2024).
<em>Properties of the reconciled distributions for Gaussian and count forecasts</em>.
International Journal of Forecasting (in press).
<a href="https://doi.org/10.1016/j.ijforecast.2023.12.004" class="external-link">doi:10.1016/j.ijforecast.2023.12.004</a>
.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="reconc_BUIS.html">reconc_BUIS()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/IDSIA/bayesRecon" class="external-link">bayesRecon</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create a minimal hierarchy with 2 bottom and 1 upper variable</span></span></span>
<span class="r-in"><span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_reconc_matrices.html">get_reconc_matrices</a></span><span class="op">(</span>agg_levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, h<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">$</span><span class="va">A</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Set the parameters of the Gaussian base forecast distributions</span></span></span>
<span class="r-in"><span><span class="va">mu1</span> <span class="op">&lt;-</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="va">mu2</span> <span class="op">&lt;-</span> <span class="fl">4</span></span></span>
<span class="r-in"><span><span class="va">muY</span> <span class="op">&lt;-</span> <span class="fl">9</span></span></span>
<span class="r-in"><span><span class="va">mus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">muY</span>,<span class="va">mu1</span>,<span class="va">mu2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sigma1</span> <span class="op">&lt;-</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="va">sigma2</span> <span class="op">&lt;-</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="va">sigmaY</span> <span class="op">&lt;-</span> <span class="fl">3</span></span></span>
<span class="r-in"><span><span class="va">sigmas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sigmaY</span>,<span class="va">sigma1</span>,<span class="va">sigma2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">Sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">sigmas</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>  <span class="co"># need to transform into covariance matrix</span></span></span>
<span class="r-in"><span><span class="va">analytic_rec</span> <span class="op">&lt;-</span> <span class="fu">reconc_gaussian</span><span class="op">(</span><span class="va">A</span>, base_forecasts.mu <span class="op">=</span> <span class="va">mus</span>,</span></span>
<span class="r-in"><span>                               base_forecasts.Sigma <span class="op">=</span> <span class="va">Sigma</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">bottom_mu_reconc</span> <span class="op">&lt;-</span> <span class="va">analytic_rec</span><span class="op">$</span><span class="va">bottom_reconciled_mean</span></span></span>
<span class="r-in"><span><span class="va">bottom_Sigma_reconc</span> <span class="op">&lt;-</span> <span class="va">analytic_rec</span><span class="op">$</span><span class="va">bottom_reconciled_covariance</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Obtain reconciled mu and Sigma for the upper variable</span></span></span>
<span class="r-in"><span><span class="va">upper_mu_reconc</span> <span class="op">&lt;-</span> <span class="va">A</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">bottom_mu_reconc</span></span></span>
<span class="r-in"><span><span class="va">upper_Sigma_reconc</span> <span class="op">&lt;-</span> <span class="va">A</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">bottom_Sigma_reconc</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Obtain reconciled mu and Sigma for the entire hierarchy</span></span></span>
<span class="r-in"><span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">A</span>, <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>  <span class="co"># first, get summing matrix S</span></span></span>
<span class="r-in"><span><span class="va">Y_mu_reconc</span> <span class="op">&lt;-</span> <span class="va">S</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">bottom_mu_reconc</span></span></span>
<span class="r-in"><span><span class="va">Y_Sigma_reconc</span> <span class="op">&lt;-</span> <span class="va">S</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">bottom_Sigma_reconc</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span>  <span class="co"># note that this is a singular matrix</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Obtain reconciled samples for the entire hierarchy:</span></span></span>
<span class="r-in"><span><span class="co"># i.e., sample from the reconciled bottoms and multiply by S</span></span></span>
<span class="r-in"><span><span class="va">chol_decomp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/chol.html" class="external-link">chol</a></span><span class="op">(</span><span class="va">bottom_Sigma_reconc</span><span class="op">)</span> <span class="co"># Compute the Cholesky Decomposition</span></span></span>
<span class="r-in"><span><span class="va">Z</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co"># Sample from standard normal</span></span></span>
<span class="r-in"><span><span class="va">B</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">chol_decomp</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Z</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">bottom_mu_reconc</span>, <span class="fl">1000</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="co"># Apply the transformation</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">U</span> <span class="op">=</span> <span class="va">S</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">B</span></span></span>
<span class="r-in"><span><span class="va">Y_reconc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">U</span>, <span class="va">B</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dario Azzimonti, Nicolò Rubattu, Lorenzo Zambon, Giorgio Corani.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

